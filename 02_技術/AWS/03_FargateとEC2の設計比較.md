# â—† Fargate vs EC2ã®è¨­è¨ˆæ¯”è¼ƒ

ä»¥ä¸‹ã§ã¯ **ECS on Fargate ã¨ ECS on EC2 ã®è¨­è¨ˆæ¯”è¼ƒ**ã‚’ã€
**ã‚ªãƒ³ãƒ—ãƒ¬ Tomcatï¼ˆWARï¼‰â†’ AWS ECS ç§»è¡Œ**ã¨ã„ã†æ–‡è„ˆã§ã€

* è¨­è¨ˆè¦³ç‚¹åˆ¥ã®é•ã„
* ãƒªã‚½ãƒ¼ã‚¹è¨­è¨ˆãƒ»æ€§èƒ½ãƒ»åˆ¶é™
* ã‚³ã‚¹ãƒˆãƒ»é‹ç”¨ãƒ»ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
* Tomcat / Java ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã§ã®å®Ÿå‹™åˆ¤æ–­åŸºæº–
* å…¸å‹çš„ãªé¸å®šãƒ‘ã‚¿ãƒ¼ãƒ³

ã¾ã§ **è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãã®ã¾ã¾ä½¿ãˆã‚‹ãƒ¬ãƒ™ãƒ«**ã§æ•´ç†ã—ã¾ã™ã€‚

---

## 1. çµè«–ã‚µãƒãƒªãƒ¼ï¼ˆã¾ãšã“ã‚Œï¼‰

| è¦³ç‚¹          | Fargate   | EC2         |
| ----------- | --------- | ----------- |
| åˆæœŸå°å…¥        | â—ï¼ˆå³åˆ©ç”¨ï¼‰    | â–³ï¼ˆè¨­è¨ˆå¤šï¼‰      |
| é‹ç”¨è² è·        | â—ï¼ˆOSç®¡ç†ä¸è¦ï¼‰ | â–³ï¼ˆOS/AMIç®¡ç†ï¼‰ |
| æ€§èƒ½ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°    | â–³         | â—           |
| é«˜è² è·/ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·  | â–³         | â—           |
| ã‚³ã‚¹ãƒˆæœ€é©åŒ–      | â–³         | â—           |
| åˆ¶é™å›é¿        | â–³         | â—           |
| Java/Tomcat | â—‹         | â—           |
| é•·æœŸå¤§è¦æ¨¡       | â–³         | â—           |

ğŸ‘‰ **ã€Œã¾ãšFargateã€è©°ã¾ã£ãŸã‚‰EC2ã€ãŒç‹é“**

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é•ã„

### 2.1 Fargate

```
ALB
 â””â”€ ECS Service
     â””â”€ Taskï¼ˆFargateï¼‰
         â””â”€ Container
```

* OS / EC2 ä¸å¯è¦–
* Taskå˜ä½ã§èª²é‡‘
* CPU / Memory çµ„ã¿åˆã‚ã›å›ºå®š

---

### 2.2 EC2

```
ALB
 â””â”€ ECS Service
     â””â”€ EC2 Instance
         â””â”€ Docker
             â””â”€ Task Ã— è¤‡æ•°
```

* ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†ã‚ã‚Š
* ãƒªã‚½ãƒ¼ã‚¹å…±æœ‰
* ç´°ã‹ã„ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¯èƒ½

---

## 3. ãƒªã‚½ãƒ¼ã‚¹è¨­è¨ˆæ¯”è¼ƒï¼ˆè¶…é‡è¦ï¼‰

### 3.1 CPU / Memory

#### Fargate

| ç‰¹æ€§     | å†…å®¹        |
| ------ | --------- |
| æŒ‡å®šæ–¹æ³•   | Taskå˜ä½    |
| CPU    | æœ€å¤§16 vCPU |
| Memory | æœ€å¤§120GB   |
| çµ„ã¿åˆã‚ã›  | å›ºå®š        |

âŒ JVM Heap å¾®èª¿æ•´ãŒé›£ã—ã„

---

#### EC2

| ç‰¹æ€§     | å†…å®¹         |
| ------ | ---------- |
| æŒ‡å®šæ–¹æ³•   | Instanceå˜ä½ |
| CPU    | åˆ¶é™ãªã—       |
| Memory | Instanceä¾å­˜ |
| çµ„ã¿åˆã‚ã›  | è‡ªç”±         |

â­• å¤§è¦æ¨¡Heap / DirectBufferå‘ã

---

## 4. Java / Tomcat è¦³ç‚¹ã®é•ã„

| è¦³ç‚¹              | Fargate | EC2  |
| --------------- | ------- | ---- |
| JVM GC          | åˆ¶é™ã‚ã‚Š    | æœ€é©åŒ–å¯ |
| HugePage        | âŒ       | â­•    |
| swap            | âŒ       | â­•    |
| File descriptor | å›ºå®š      | èª¿æ•´å¯  |
| Kernel param    | ä¸å¯      | å¯èƒ½   |

ğŸ‘‰ **ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· or é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¯EC2æœ‰åˆ©**

---

## 5. ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­è¨ˆ

### 5.1 Fargate

| ç‰¹æ€§      | å†…å®¹     |
| ------- | ------ |
| ã‚¹ã‚±ãƒ¼ãƒ«    | Taskå˜ä½ |
| èµ·å‹•æ™‚é–“    | 30ã€œ90ç§’ |
| æœ€å°å˜ä½    | 1 Task |
| Burstè€æ€§ | â–³      |

---

### 5.2 EC2

| ç‰¹æ€§   | å†…å®¹              |
| ---- | --------------- |
| ã‚¹ã‚±ãƒ¼ãƒ« | Instance + Task |
| èµ·å‹•æ™‚é–“ | æ•°åˆ†              |
| æœ€å°å˜ä½ | Instance        |
| å®šå¸¸è² è· | â—               |

---

## 6. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»åŒæ™‚æ¥ç¶š

| è¦³ç‚¹             | Fargate | EC2        |
| -------------- | ------- | ---------- |
| ENI            | Taskã”ã¨  | Instanceã”ã¨ |
| Ephemeral Port | å°‘ãªã‚     | å¤šã„         |
| åŒæ™‚æ¥ç¶š           | â–³       | â—          |

ğŸ‘‰ **APIå¤§é‡æ¥ç¶šã¯EC2æœ‰åˆ©**

---

## 7. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«

| é …ç›®     | Fargate | EC2     |
| ------ | ------- | ------- |
| æ°¸ç¶šåŒ–    | EFSã®ã¿   | EBS/EFS |
| I/Oæ€§èƒ½  | â–³       | â—       |
| ãƒ­ãƒ¼ã‚«ãƒ«FS | æ®ç™º      | ç®¡ç†å¯     |

---

## 8. ã‚³ã‚¹ãƒˆæ¯”è¼ƒï¼ˆç›®å®‰ï¼‰

### 8.1 åŒç­‰æ§‹æˆä¾‹

* 4 vCPU / 16GB
* å¸¸æ™‚ç¨¼åƒ

| ç¨®åˆ¥          | æœˆé¡      |
| ----------- | ------- |
| Fargate     | é«˜       |
| EC2 (RI/SP) | 30ã€œ50%å®‰ |

ğŸ‘‰ **24/365ã¯EC2åœ§å‹**

---

## 9. å¯ç”¨æ€§ãƒ»éšœå®³å¯¾å¿œ

| è¦³ç‚¹   | Fargate | EC2  |
| ---- | ------- | ---- |
| AZåˆ†æ•£ | è‡ªå‹•      | è¨­è¨ˆå¿…è¦ |
| éšœå®³å¾©æ—§ | æ—©ã„      | é‹ç”¨æ¬¡ç¬¬ |
| OSéšœå®³ | AWSå¯¾å¿œ   | è‡ªå·±å¯¾å¿œ |

---

## 10. åˆ¶é™ä¸€è¦§ï¼ˆé‡è¦ï¼‰

### Fargateåˆ¶é™ï¼ˆæŠœç²‹ï¼‰

* CPUÃ—Memoryå›ºå®š
* HugePageä¸å¯
* Host accessä¸å¯
* ulimitå¤‰æ›´ä¸å¯

### EC2åˆ¶é™

* EC2åˆ¶é™ã®ã¿ï¼ˆå®Ÿè³ªç„¡åˆ¶é™ï¼‰

---

## 11. å…¸å‹çš„ãªé¸å®šãƒ‘ã‚¿ãƒ¼ãƒ³

#### Fargateå‘ã

* Web/APIï¼ˆä¸­è¦æ¨¡ï¼‰
* è² è·å¤‰å‹•å¤§
* é‹ç”¨äººå“¡å°‘
* PoC / çŸ­æœŸ

#### EC2å‘ã

* å¤§è¦æ¨¡Java
* é«˜åŒæ™‚æ¥ç¶š
* ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
* å¸¸æ™‚é«˜è² è·

---

## 12. å®Ÿå‹™å‘ã‘åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
24/365 ç¨¼åƒï¼Ÿ
 â”œâ”€ Yes â†’ EC2
 â””â”€ No
     â†“
Heap > 16GBï¼Ÿ
 â”œâ”€ Yes â†’ EC2
 â””â”€ No
     â†“
Kernel tuning å¿…è¦ï¼Ÿ
 â”œâ”€ Yes â†’ EC2
 â””â”€ No â†’ Fargate
```

---
