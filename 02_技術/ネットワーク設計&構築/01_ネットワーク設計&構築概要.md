# ◆ **ネットワーク設計/構築の概要**

ネットワーク設計/構築、特にL2/L3スイッチ、ファイアウォール、ロードバランサーに関する技術領域について、詳細に説明いたします。

この分野は、現代の企業ITインフラを支える根幹技術であり、信頼性・安全性・性能を確保する上で極めて重要です。

---

## **1. ネットワーク設計/構築の基本概念**

ネットワーク設計とは、ビジネス要件（可用性、性能、セキュリティ、コスト、拡張性など）を満たすための最適なネットワーク構造を計画するプロセスです。構築は、その設計に基づいて物理的・論理的な設定を行い、ネットワークを実際に稼働させるまでの作業を指します。

**設計の基本原則:**
*   **階層化モデル（コア・ディストリビューション・アクセス）**: ネットワークを役割ごとに層に分けることで、管理性、拡張性、耐障害性を向上させます。
*   **冗長化**: 機器や回線を二重化し、単一障害点（SPOF）をなくすことで、可用性を高めます。
*   **セグメンテーション**: ネットワークを論理的に分割し、障害やセキュリティインシデントの影響範囲を局所化します。
*   **スケーラビリティ**: 将来の成長や変化に柔軟に対応できる構造とします。

---

## **2. 各コンポーネントの詳細な説明**

### **【L2スイッチ】 - データリンク層での通信**

*   **役割**: 同じネットワークセグメント（サブネット）内での通信を実現します。MACアドレスを基にフレームの転送先を決定します。
*   **主な技術と機能**:
    *   **VLAN（Virtual LAN）**: 物理的な1台のスイッチを、論理的に複数の仮想スイッチに分割します。異なる部署間でブロードキャストドメインを分離し、セキュリティとトラフィック効率を向上させます。
    *   **STP（Spanning Tree Protocol）**: スイッチ間のループ構成を検出し、論理的にツリー状の経路を構築してブロードキャストストームを防止します。高速化版として**Rapid STP** や**MSTP** が一般的です。
    *   **LAG（Link Aggregation Group） / イーサチャネル**: 複数の物理ポートを1つの論理リンクとして束ね、帯域幅の増加とリンクの冗長化を実現します。
    *   **VLAN間ルーティング（L3スイッチ機能との連携）**: L3スイッチと連携し、異なるVLAN間の通信を可能にします。

### **【L3スイッチ】 - ネットワーク層での通信（ルーティング）**

*   **役割**: 異なるネットワークセグメント（サブネット）間の通信を実現します。IPアドレスを基にパケットの転送経路（ルーティング）を決定します。従来のルーターよりも高速なハードウェアベースのルーティングが特徴です。
*   **主な技術と機能**:
    *   **ルーティングプロトコル**:
        *   **OSPF（Open Shortest Path First）**: 大規模ネットワークで広く利用されるリンクステート型の内部ゲートウェイプロトコルです。ネットワークの変化に素早く適応し、最適経路を計算します。
        *   **BGP（Border Gateway Protocol）**: インターネットサービスプロバイダ（ISP）間や、大規模企業の大拠点間で使用されるパスベクター型の外部ゲートウェイプロトコルです。ポリシーに基づいた高度な経路制御が可能です。
    *   **VRRP（Virtual Router Redundancy Protocol） / HSRP（Hot Standby Router Protocol）**: デフォルトゲートウェイを仮想化し、冗長化を構成します。アクティブな機器が故障しても、スタンバイ機器が瞬時に引き継ぎ、通信を継続します。
    *   **ACL（Access Control List）**: IPアドレスやポート番号に基づいて、通過するパケットを許可または拒否するフィルタリング機能を提供します（基本的なセキュリティ対策）。

### **【ファイアウォール (FW)】 - セキュリティの中枢**

*   **役割**: 信頼できるネットワーク（内部ネットワーク）と信頼できないネットワーク（インターネット等）の境界に設置し、セキュリティポリシーに基づいて通信を厳格に制御します。**「デフォルト拒否」** が基本原則です。
*   **主な技術と機能**:
    *   **ステートフルインスペクション**: 通信のセッション（状態）を管理し、正当な応答パケットのみを通すことで、セキュリティを高めます。現在のFWの標準技術です。
    *   **NAT/NAPT（Network Address Translation / Port Address Translation）**: プライベートIPアドレスとグローバルIPアドレスを相互変換し、内部ネットワークを隠蔽するとともに、限られたグローバルIPアドレスを有効利用します。
    *   **アプリケーション制御 / URLフィルタリング**: パケットのIPやポートだけでなく、アプリケーション自体やアクセス先のWebサイトカテゴリを識別して制御します。
    *   **IPS/IDS（Intrusion Prevention/Detection System）**: 既知の脆弱性を悪用する攻撃パターンを検知し、**IDS**は警告を、**IPS**は通信を遮断します。多くのNGFWはIPS機能を統合しています。
    *   **VPN（Virtual Private Network）**:
        *   **サイト間VPN**: 離れた拠点間を暗号化トンネルで接続し、あたかも同一のネットワークのように利用できるようにします。
        *   **リモートアクセスVPN**: 外出先や在宅勤務の従業員が、安全に社内ネットワークにアクセスできるようにします。
    *   **次世代ファイアウォール (NGFW)**: 従来のFW機能に加え、アプリケーション制御、IPS、高度な脅威防御（サンドボックス等）、ユーザーIDベースの制御などを統合したものです。

### **【ロードバランサー (LB)】 - 負荷分散と高可用性**

*   **役割**: 複数のサーバーやアプリケーションに対して、クライアントからのリクエストを振り分け、負荷を分散させます。また、サーバーの死活監視を行い、障害が発生したサーバーへのトラフィックを自動的に停止させることで、アプリケーション全体の可用性を向上させます。
*   **主な技術と機能**:
    *   **負荷分散アルゴリズム**:
        *   **ラウンドロビン**: リクエストを順番に振り分けます。
        *   **リーストコネクション**: 現在の接続数が最も少ないサーバーに振り分けます。
        *   **応答速度**: 応答が最も速いサーバーに振り分けます。
    *   **仮想IP（VIP）**: クライアントがアクセスするための単一のエントリポイントとなるIPアドレスです。LBがこのVIPを管理し、背後にある実サーバーに転送します。
    *   **ヘルスチェック（死活監視）**: 定期的にサーバーやアプリケーションの状態を確認し、正常でない場合は負荷分散の対象から外します。
    *   **SSLオフロード**: クライアントとLB間の暗号化/復号処理をLBが代行し、背後にあるサーバーの処理負荷を軽減します。
    *   **コンテンツスイッチング（レイヤー7スイッチング）**: URLやHTTPヘッダーなどのアプリケーション層の情報を元に、リクエストを適切なサーバーやサービスに振り分けます（例: `/api/` へのアクセスはAPサーバーへ、`/images/` へのアクセスはWebサーバーへ）。

---

## **3. 実際の設計/構築の流れ**

1.  **要件定義**:
    *   ビジネス目標、ユーザー数、想定トラフィック、可用性目標（例: 99.999%）、セキュリティポリシー、予算などを明確にします。
2.  **基本設計**:
    *   ネットワークトポロジー（物理/論理構成図）の決定。
    *   IPアドレス設計（サブネット設計）。
    *   使用する機器の選定とキャパシティプランニング。
    *   セキュリティ方針（ゾーン構成、FWポリシー）の策定。
3.  **詳細設計**:
    *   各機器の具体的な設定内容（VLAN、ルーティングプロトコル、FWルール、LB仮想サーバー設定など）を決定。
    *   冗長化構成の詳細（STPの役割決定、VRRPの優先順位など）。
    *   障害発生時の切り替え手順や運用・監視方針の設計。
4.  **構築・設定**:
    *   機器のラック設置、配線。
    *   設計書に基づく設定作業。特に初期設定は**Out-of-Band管理**が推奨されます。
5.  **テスト・検証**:
    *   接続性テスト（ピング、トレースルート）。
    *   負荷テスト（性能要件の達成確認）。
    *   フェイルオーバーテスト（冗長化の動作確認）。
    *   セキュリティポリシーの動作確認。
6.  **ドキュメント作成・引き継ぎ**:
    *   ネットワーク構成図、設定値一覧、運用マニュアルなどを作成し、運用チームに引き継ぎます。
7.  **運用・監視・保守**:
    *   継続的な監視、設定変更管理、定期的なレビューと最適化を行います。

---

## **4. 設計例：3層Webシステムのネットワーク構成**

典型的なオンラインサービスを想定した例です。

1.  **フロントエンド（DMZゾーン）**:
    *   **LB**がインターネットからのアクセスを受け付け、**Webサーバー**群に負荷分散します。
    *   **FW**は、インターネット→LB（ポート443/HTTPS）のみを許可し、内部への不正アクセスを遮断します。
2.  **ミドルティア（アプリケーションゾーン）**:
    *   Webサーバーからのリクエストを、**LB**または**L3スイッチ**のレイヤ7機能を用いて**APサーバー**群に振り分けます。
    *   **FW**は、Webサーバー→APサーバー（特定ポート）のみを許可する厳格なポリシーを設定します。
3.  **バックエンド（データベースゾーン）**:
    *   APサーバーからのアクセスを、**DBサーバー**が受け付けます。
    *   **FW**は、APサーバー→DBサーバー（例: 3306/MySQL）のみを許可し、最も厳重に保護します。
4.  **基盤ネットワーク**:
    *   各ゾーンは**L3スイッチ**で接続され、VLANで論理的に分離されています。
    *   L3スイッチ間では**OSPF**で動的ルーティングを行い、経路の冗長化と自動収束を実現しています。
    *   スタッフが利用する**内部クライアントネットワーク**も別VLANで分離されています。

このように、各コンポーネントを適切に組み合わせ、階層化とセグメンテーションを徹底することで、高性能で回復力があり、安全なネットワークを構築することができます。
