# ◆ オンプレミス環境：ネットワーク設計・構築（詳細ガイド）

以下は、オンプレミスのネットワーク設計〜構築〜引き渡し・運用定着までの**実務で使えるフロー**と、各工程で必要となる**入力データ／情報、具体タスク、成果物（テンプレ例含む）、手順書の骨子**です。実プロジェクトでそのまま使える実務寄りのチェックリストも付けます。

---

## 1) 全体フェーズ（短い一覧）

1. 事前調査（Discovery / 現状把握）
2. 要件定義（SLA・セキュリティ・性能）
3. 論理設計（L2/L3、IP設計、VLAN、サブネット、セグメント）
4. 物理設計（配線、ラック、電源、冗長）
5. セキュリティ設計（FW、IDS/IPS、アクセス制御、DMZ）
6. 詳細設計（ルーティング、NAT、ACL、QoS、負荷分散）
7. 構築（機器設定・配線・ラベリング）
8. テスト（単体・結線・負荷・セキュリティ）
9. 本番移行（切替手順、ロールバック）
10. 引き渡し・運用準備（監視、運用手順、バックアップ）
11. 保守・改善（定期レビュー、脆弱性対応）

---

## 2) 事前調査（入力データ・確認情報）

* 既存ネットワーク図（物理/論理）
* 機器インベントリ（型番、FWバージョン、ライセンス）
* ケーブル構成・配線図、パッチパネル情報
* 既存IPアドレスプラン（利用率・重複チェック）
* サイト（データセンタ／拠点）物理条件（電源容量、床荷重、空調）
* ネットワーク利用者・役割（システム一覧、重要度）
* 帯域利用実績（SNMP/フロー、ピーク/平均）
* セキュリティポリシー（社内・業界規定、コンプライアンス）
* 可用性要件（RPO/RTO、MTTR目標）
* 予定予算・調達期限

**成果物（この工程）**

* 現状調査レポート（問題点、制約、改善提案）
* 要件サマリ（各ステークホルダ確認済み）

---

## 3) 要件定義（出力：設計方針）

* 可用性：冗長構成（コア/配下スイッチの冗長、二重化電源、複数回線）
* 性能：必要帯域、レイテンシ目標、スループット（GBps）
* セキュリティ：分離すべきセグメント（管理／DMZ／検証環境等）
* 管理：SNMP、Syslog、AAA（RADIUS/LDAP）、バックアップ方針
* 運用：営業時間・保守窓口、変更管理プロセス
* 将来拡張：IP空間・VLANの余裕、PoE容量、ラック余力

**成果物**

* ネットワーク要件定義書（SLA・非機能要件含む）

---

## 4) 論理設計（L2/L3、セグメント設計）

### 主要作業

* **IPアドレス設計**：サブネット割当、予約ポリシー、DHCPスコープ設計
* **VLAN設計**：用途別VLAN表（ID/名前/用途/タグ付けポリシー）
* **ルーティング設計**：静的ルート or ダイナミック（OSPF/EIGRP/BGP）選定、集約方針
* **冗長プロトコル**：HSRP/VRRP/GLBPの採用と優先度設定
* **NAT設計**：インターネット接続（PAT/1:1 NAT）、DMZ公開ポリシー
* **アクセス制御**：ACL設計（セグメント間・外部向け）
* **QoS設計**：クラス分け、優先度、帯域制御（音声/動画/バッチ）

**成果物（テンプレ）**

* 論理設計書（IPプラン表、VLAN表、ルーティング図）
* IPアドレス割当表（例：10.10.0.0/16 → 管理VLAN 10: 10.10.10.0/24 等）

---

## 5) 物理設計（配線・ラック・電源）

### 主要作業

* ラック配置と機器配置（U数、空冷、ケーブル経路）
* ケーブル種別（光/UTP Cat6A 等）、長さ・リンク確認
* パッチパネルとポート配置図の設計
* 電源設計：冗長電源、UPS容量、PDU配置
* クロスサイト回線（WAN、専用線、インターネット回線）の回線図
* アース、EMC対策、ケーブルトレイ設計

**成果物**

* 配線図、ラック配置図、電源表

---

## 6) セキュリティ設計

* DMZ構成（公開サービスの分離、ロードバランサ配置）
* ファイアウォールルール設計（ルールテンプレ、管理ポリシー）
* 管理アクセス制御（管理VLAN、ジャンプホスト）
* ログ管理（Syslogサーバ、保持ポリシー、SIEM連携）
* 侵入検知/防御（IDS/IPS）配置とシグネチャ運用方針
* 暗号化（IPsec/VPN、TLS要件）、鍵管理方針
* 脆弱性対応フロー（パッチ適用・通報ルート）

**成果物**

* セキュリティ設計書（FWルール一覧、VPN設計、監視設計）

---

## 7) 詳細設計（設定値・テンプレ）

* 機器ごとの設定テンプレ（スイッチ、ルータ、FW、LB、WLC）
* CLI設定サンプル：インターフェース、VLAN、SVI、HSRP設定、OSPF/BGPサンプル
* SNMP設定（コミュニティ名／v3ユーザ）、NTP、DNS設定
* 管理ポート保護（port-security、BPDUガード等）
* スクリプト化：大量設定はAnsible/Terraformで自動化する場合のプレイブック例
* 監視項目（インターフェース使用率、CPU/メモリ、アラート閾値）

**成果物**

* 機器別設定テンプレ（ファイル名例：`switch_core01_config.txt`）
* 自動化プレイブック（例：Ansible roles）

---

## 8) 構築（実作業）

### 作業手順（例：コアスイッチ導入）

1. 機器受領→シール／資産登録
2. ラック実装→電源接続→コンソール接続
3. 基本設定（ホスト名、管理IP、NTP、SNMP、AAA）
4. VLAN/インターフェース設定→パッチパネル接続確認
5. 冗長プロトコル設定（HSRP等）→フェイルオーバー動作確認
6. FW/NAT/LBのルール投入（段階的に）
7. 監視連携（Zabbix/Prometheus等にホスト登録）
8. 設定のバックアップ（中央リポジトリ、バージョン管理）

**成果物**

* 構築ログ（実行したコマンド、日時、担当者）
* 機器設定ファイルのリポジトリ（バックアップ）

---

## 9) テスト（テスト項目と合格基準）

### テスト種類（具体例）

* **単体テスト**：インターフェース UP/DOWN、VLANタグ確認、IP疎通
* **結合テスト**：ルーティング通過性、FWルール検証（許可/拒否ケース）
* **負荷テスト**：想定ピークの1.5〜2倍でのスループット試験、パケットロス無し
* **フェイルオーバーテスト**：リンク断や機器停止での冗長動作確認（切替時間計測）
* **セキュリティテスト**：ポートスキャン、脆弱性スキャン、ACLの効果確認
* **運用テスト**：監視アラート送信、ログ取得・保管確認、バックアップ復元確認

**成果物**

* テスト仕様書、テスト結果レポート（合格/不合格、残課題）

---

## 10) 本番移行とロールアウト

* 移行計画（時間帯、ダウンタイム、ステップ）
* 切替手順（順序、コマンド、検証ポイント）
* ロールバック手順（即時戻す条件と手順）
* 影響範囲通知（関係者・ビジネス影響）
* 移行後の監視強化（一定期間アラート閾値を低めに設定）

**成果物**

* 移行実行記録（タイムライン、問題、対処履歴）

---

## 11) 引き渡し・運用（Runbook等）

* 運用マニュアル（障害対応フロー、連絡先、エスカレーション）
* 監視・アラート運用ルール（閾値、対応時間）
* 定期作業手順（バックアップ、証明書更新、パッチ適用）
* 変更管理テンプレ（RFCテンプレ、影響試算シート）
* 運用テーブル（保守窓口、保守時間、SLA）

**成果物**

* Runbook（例：`runbook_network_incident.md`）
* 運用引き継ぎチェックリスト（確認済みサイン欄付き）

---

## 12) ドキュメント・成果物一覧（配布ファイル名例）

* `01_network_requirement_spec.pdf` — 要件定義書
* `02_network_logical_design.vsdx` — 論理図（Visio）
* `03_network_physical_design.pdf` — 配線・ラック図
* `04_ip_address_plan.xlsx` — IP割付表
* `05_firewall_rules.xlsx` — FWルール一覧（番号/説明/許可元/宛先/サービス）
* `06_device_configs/` — 機器設定リポジトリ（ファイル群）
* `07_test_plan_and_results.xlsx` — テスト仕様・結果
* `08_runbook.md` — 運用手順書
* `09_change_requests_log.xlsx` — 変更管理台帳

---

## 13) 実務チェックリスト（導入前確認用／要点）

* [ ] IPアドレスの重複がないか確認済みか
* [ ] VLANとポートのラベリングは現場と一致しているか
* [ ] 冗長経路は物理的に分離されているか（ラック/経路）
* [ ] 管理ネットワークは本番トラフィックと論理的に分離されているか
* [ ] FWルールに“any any allow”の無駄な例外がないか
* [ ] 監視・ログが適切に取得・保管されているか（保持期間）
* [ ] 機器設定のバックアップ・差分管理が行われているか
* [ ] 切替とロールバック手順がテストされているか（実行リハーサル）
* [ ] 運用チームへの引き渡しとナレッジ転送が完了しているか

---

## 14) 設計・構築でよくある課題（対処案）

* **IP枯渇**：／16など粗めの設計から将来を見越したサブネット設計へ移行。DHCP reservation運用。
* **ケーブル管理不備**：パッチパネル表・ラベル規約を作り、写真で記録。
* **設定差分管理不足**：Gitで設定ファイルを管理、CIで差分検出。
* **運用負荷**：RepeatableなAnsible化で初期投入と再利用を図る。
* **セキュリティ漏れ**：リリース前に必ず外部脆弱性スキャンとルールレビューを実施。

---

## 15) 参考：よく使うテンプレ（短縮例）

* **FWルール行**：`#ID｜ステータス｜ソース(VLAN/IP)｜宛先(VLAN/IP)｜サービス｜アクション｜理由｜承認者`
* **IP割当1行**：`用途｜VLAN｜サブネット｜範囲｜予約｜備考`
* **テストケース**：`TC001｜VLAN10→VLAN20の疎通確認｜コマンド｜期待結果｜実測結果｜判定`

---
