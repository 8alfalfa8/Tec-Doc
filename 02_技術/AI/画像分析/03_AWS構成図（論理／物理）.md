# ◆ AWS構成図（論理／物理）

以下に、**AWSにおける画像分析システムの「論理構成図／物理構成図」**を、
**設計書にそのまま転記できる粒度（金融・公共案件対応）**で整理します。

※ 図は**テキスト構成図（設計書用）＋解説**の形式で記載します
（Visio / Draw.io / PowerPoint に落とし込みやすい表現です）

---

## 1. 論理構成図（Logical Architecture）

👉 **「何の機能が、どの役割で連携するか」**を示す図
（AWSサービス名は出すが、AZやNW詳細は出さない）

---

### 1.1 論理構成図（標準・サーバレス型）

```
┌───────────────────────────────────┐
│        利用者 / 外部システム 　     │
│  (Web / Mobile / Camera / Batch)  │
└───────────────┬───────────────────┘
                │ HTTPS
                ▼
        ┌────────────────┐
        │ API Gateway    │
        │ (認証・制御)    │
        └───────┬────────┘
                ▼
        ┌────────────────┐
        │ Lambda         │
        │ 前処理・制御    │
        └───────┬────────┘
                │
   ┌────────────┼────────────┐
   ▼            ▼            ▼
┌───────┐  ┌───────────┐  ┌─────────┐
│S3(Raw)│  │Rekognition│  │Textract │
└───┬───┘  └────┬──────┘  └────┬────┘
    │           │              │
    ▼           ▼              ▼
┌─────────────────┐     ┌────────────┐
│ 後処理 Lambda 　 │     │Comprehend  │
└───────┬─────────┘     └────┬───────┘
        ▼                    ▼
┌─────────────────────────────────┐
│ 業務データストア                 │
│ DynamoDB / Aurora / S3(Result)  │
└───────────────┬─────────────────┘
                ▼
      ┌─────────────────────┐
      │ 可視化・連携         │
      │ Athena / QuickSight │
      │ SNS / EventBridge   │
      └─────────────────────┘
```

---

#### 論理構成のポイント

| 観点 | 設計意図            |
| -- | --------------- |
| 入力 | API / S3 両対応    |
| 分離 | Raw画像と結果の分離     |
| AI | マネージドAI中心       |
| 拡張 | SageMakerを後付け可能 |

---

### 1.2 論理構成図（カスタムAI / SageMaker併用）

```
S3(Raw)
  ▼
Lambda(前処理)
  ▼
SageMaker Endpoint
  ▼
Lambda(後処理)
  ▼
業務DB / S3(Result)
```

---

## 2. 物理構成図（Physical Architecture）

👉 **「AWSアカウント・VPC・NW・AZ単位」**を明示
（監査・セキュリティ説明用）

---

### 2.1 AWSアカウント構成（推奨）

```
AWS Organizations
 ├─ 管理アカウント
 ├─ 共有サービスアカウント（監査/ログ）
 ├─ 開発アカウント
 ├─ 検証アカウント
 └─ 本番アカウント
```

---

### 2.2 物理構成図（本番・高信頼）

```
┌────────────────────────────────────────┐
│         AWSアカウント（本番）            │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │ VPC                              │  │
│  │ CIDR: 10.0.0.0/16                │  │
│  │                                  │  │
│  │  ┌────────────┐ ┌────────────┐   │  │
│  │  │ Public AZ-a│ │ Public AZ-c│   │  │
│  │  │ ALB/API GW │ │ ALB/API GW │   │  │
│  │  └────────────┘ └────────────┘   │  │
│  │                                  │  │
│  │  ┌─────────────┐ ┌─────────────┐ │  │
│  │  │ Private AZ-a│ │ Private AZ-c│ │  │
│  │  │ Lambda/ECS  │ │ Lambda/ECS  │ │  │
│  │  │ SageMaker   │ │ SageMaker   │ │  │
│  │  └─────────────┘ └─────────────┘ │  │
│  │                                  │  │
│  │  ┌───────────┐ ┌─────────┐       │  │
│  │  │ DB AZ-a   │ │ DB AZ-c │       │  │
│  │  │ Aurora    │ │ Aurora  │       │  │
│  │  └───────────┘ └─────────┘       │  │
│  │                                  │  │
│  └──────────────────────────────────┘  │
│                                        │
│  S3（VPC Endpoint接続）                 │
│  DynamoDB（Endpoint）                  │
│                                        │
└────────────────────────────────────────┘
```

---

#### 物理構成の重要ポイント

| 項目  | 内容           |
| --- | ------------ |
| VPC | Private中心設計  |
| AZ  | 2AZ以上        |
| 通信  | VPC Endpoint |
| 外部  | インターネット境界最小  |

---

### 2.3 ネットワークセキュリティ構成

```
Internet
  │
WAF
  │
ALB / API Gateway
  │
Private Subnet
  │
Lambda / ECS / SageMaker
  │
DB / S3
```

* WAF：画像アップロード制限
* SG/NACL：最小許可
* KMS：全暗号化

---

## 3. 論理 ↔ 物理 対応表（設計書用）

| 論理要素 | 物理要素                    |
| ---- | ----------------------- |
| API  | API Gateway + WAF       |
| 前処理  | Lambda / ECS            |
| AI推論 | Rekognition / SageMaker |
| 業務DB | Aurora / DynamoDB       |
| 保存   | S3（KMS）                 |
| 分析   | Athena / QuickSight     |

---

## 4. 設計書に記載すべき補足説明（監査向け）

* **個人情報画像の取り扱い**
* **AI判断と人手判断の責任分界**
* **再学習・モデル更新手順**
* **障害時の手動代替フロー**

---
