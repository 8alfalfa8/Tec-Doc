# ◆ DNSレコード

以下では、**DNSレコードの種類・用途・登録／削除方法**を、
**金融・公共系システム／AWS（Route53）＋オンプレDNS（BIND）** の実務を前提に、体系的かつ深掘りしてご説明します。

---

## 1. DNSレコードとは（前提整理）

DNSレコードは、**ドメイン名に対する「名前解決ルール」**を定義する情報です。
主に以下を管理します。

* **どの名前が**
* **どのIP／サービスに**
* **どの条件で紐づくか**

DNSは「設定ミス＝即サービス影響」になるため、金融・公共では
👉 **用途別のレコード理解＋変更統制が極めて重要**です。

---

## 2. DNSレコード主要種類一覧（必須）

| 種類    | 主用途        | 利用頻度 |
| ----- | ---------- | ---- |
| A     | IPv4アドレス解決 | ★★★  |
| AAAA  | IPv6アドレス解決 | ★★   |
| CNAME | 別名定義       | ★★★  |
| NS    | ゾーン委任      | ★★★  |
| MX    | メール配送      | ★★★  |
| TXT   | 認証・検証      | ★★★  |
| SOA   | ゾーン管理情報    | ★★★  |
| PTR   | 逆引き        | ★★   |

---

## 3. 各DNSレコードの詳細

---

### ① Aレコード（Address）

#### 用途

* **ドメイン名 → IPv4アドレス** の変換
* Webサーバ、APサーバ向け

#### 例

```
www.example.com.   300   IN   A   203.0.113.10
```

#### ポイント

* **最も基本的**
* IP直指定のため、**IP変更時は必ずDNS変更が必要**

#### 金融向け注意

* IP直指定は変更リスクが高いため
  → **LB（ALB/NLB）＋CNAME/Alias推奨**

---

### ② AAAAレコード（IPv6）

#### 用途

* **ドメイン名 → IPv6アドレス**

#### 例

```
www.example.com.   300   IN   AAAA   2001:db8::10
```

#### 注意

* IPv6通信が許可されていない環境では
  👉 **AAAAを登録すると通信障害の原因**になる

---

### ③ CNAMEレコード（Canonical Name）

#### 用途

* **別名定義**
* AWS ALB / CloudFront 等で多用

#### 例

```
www.example.com.   300   IN   CNAME   alb-xxx.ap-northeast-1.elb.amazonaws.com.
```

#### 制約（重要）

* **CNAMEは同一名称で他レコードと共存不可**
* ルートドメイン（example.com）には通常使えない

#### AWS補足

* Route53では **Aliasレコード** を使えば
  ルートドメインにもLBを紐付け可能

---

### ④ NSレコード（Name Server）

#### 用途

* **権威DNSサーバの指定**
* ゾーン委任・DNS切替の中核

#### 例

```
example.com.   172800   IN   NS   ns-123.awsdns-45.com.
```

#### 金融向けポイント

* **DNS移行時はNS切替が最大リスクポイント**
* TTL短縮＋並行稼働必須

---

### ⑤ MXレコード（Mail Exchange）

#### 用途

* **メール配送先の指定**

#### 例

```
example.com.   3600   IN   MX   10 mail1.example.com.
example.com.   3600   IN   MX   20 mail2.example.com.
```

#### 注意

* 優先度（数値が小さいほど優先）
* 誤設定すると **即メール不達**

---

### ⑥ TXTレコード

#### 用途

* **認証・検証・ポリシー定義**

  * SPF / DKIM / DMARC
  * ドメイン所有確認

#### 例（SPF）

```
example.com.   3600   IN   TXT   "v=spf1 ip4:203.0.113.0/24 -all"
```

#### 金融・公共

* メールなりすまし対策で必須
* **長文・複数行管理ミス注意**

---

### ⑦ SOAレコード（Start of Authority）

#### 用途

* **ゾーンの管理情報**
* シリアル番号で更新管理

#### 例

```
example.com. IN SOA ns1.example.com. admin.example.com. (
  2026010101 ; Serial
  3600       ; Refresh
  600        ; Retry
  1209600    ; Expire
  300 )      ; Minimum TTL
```

#### ポイント

* **ゾーンに必ず1つ**
* シリアル番号更新忘れはゾーン転送トラブル原因

---

### ⑧ PTRレコード（逆引き）

#### 用途

* **IP → ドメイン名**
* メール・監査ログ用途

#### 例

```
10.113.0.203.in-addr.arpa. IN PTR www.example.com.
```

---

## 4. DNSレコードの登録・削除方法

---

### ① AWS Route53での登録・削除

#### 登録

1. Hosted Zone選択
2. 「レコードを作成」
3. レコードタイプ選択（A / CNAME 等）
4. TTL設定（切替時は短く）
5. 保存

#### 削除

* 該当レコード選択 → 削除
* **Aliasレコード削除は即反映されるため要注意**

---

### ② BIND（オンプレDNS）での登録・削除

#### 登録（zoneファイル）

```
www   IN   A   203.0.113.10
```

#### 削除

* レコード行削除
* **SOAシリアル番号更新必須**
* named再読み込み

```
rndc reload
```

---

## 5. レコード変更時の運用ルール（金融・公共）

| 項目     | ルール                  |
| ------ | -------------------- |
| TTL    | 通常：3600 / 切替時：300以下  |
| 作業     | 必ず作業手順書＋承認           |
| 検証     | dig/nslookupで事前・事後確認 |
| ロールバック | 旧値即復旧可能に保持           |

---

## 6. よくある障害例

| 障害       | 原因         |
| -------- | ---------- |
| サイト表示不可  | A/CNAME誤設定 |
| 一部端末のみ不通 | TTLキャッシュ   |
| メール不達    | MX/TXT誤設定  |
| 切替後不安定   | NS反映遅延     |

---

## 7. まとめ（重要）

* DNSレコードは **種類ごとに役割が明確**
* 金融・公共では
  👉 **変更最小化・TTL制御・並行稼働が最重要**
* Route53とBINDでは
  👉 **Alias・Private ZoneなどAWS特有設計に注意**

---

以下は、**金融・公共系システム向けの「DNSレコード設計書テンプレート」**です。
**監査対応・変更統制・高可用性**を前提に、**そのまま設計書として提出可能な粒度**で章立て＋記載例を示します。

---

# ◆ DNSレコード設計書

（金融・公共向けテンプレート）

---

## 1. はじめに

### 1.1 目的

本設計書は、対象システムにおけるDNSレコードの設計方針、レコード定義、運用・変更ルールを明確化し、
**可用性・セキュリティ・運用統制・監査対応**を担保することを目的とする。

### 1.2 適用範囲

* パブリックDNS（外部公開）
* プライベートDNS（内部利用）
* AWS Route53 / オンプレミスDNS（BIND）

### 1.3 前提条件（記載例）

* システム種別：金融系Webアプリケーション
* 稼働環境：AWS（本番／災対）、オンプレミス（社内系）
* DNS冗長構成：マルチAZ／マルチNS

---

## 2. DNS設計方針

### 2.1 基本方針

| 項目     | 方針           |
| ------ | ------------ |
| 可用性    | 権威DNSは複数NS構成 |
| 変更影響   | TTL制御により最小化  |
| セキュリティ | 不要レコードは登録しない |
| 運用統制   | 事前承認・作業証跡必須  |

---

### 2.2 金融・公共向け制約事項

* DNSレコード変更は **本番作業申請＋承認必須**
* 緊急変更時も **事後レビュー必須**
* DNSログ・変更履歴は **〇年間保存**

---

## 3. DNSゾーン設計

### 3.1 ゾーン構成

| ゾーン名                 | 種別      | 用途    |
| -------------------- | ------- | ----- |
| example.com          | Public  | 外部公開  |
| internal.example.com | Private | 内部業務用 |

---

### 3.2 NS構成（記載例）

| NS名                | 所在  | 備考        |
| ------------------ | --- | --------- |
| ns-1.awsdns-xx.com | AWS | Primary   |
| ns-2.awsdns-yy.net | AWS | Secondary |

---

## 4. DNSレコード設計一覧（重要章）

### 4.1 レコード一覧表（テンプレ）

| No | FQDN                                      | 種別    | 値                         | TTL  | 用途   | 備考      |
| -- | ----------------------------------------- | ----- | ------------------------- | ---- | ---- | ------- |
| 1  | [www.example.com](http://www.example.com) | A     | 203.0.113.10              | 300  | Web  | 切替用短TTL |
| 2  | api.example.com                           | CNAME | alb-xxx.elb.amazonaws.com | 300  | API  | AWS ALB |
| 3  | example.com                               | MX    | mail.example.com          | 3600 | Mail | 優先度10   |

---

### 4.2 レコード種別別設計方針

#### A / AAAAレコード

* IP直指定は最小限
* LB配下はCNAME/Aliasを優先

#### CNAMEレコード

* ルートドメインでは使用しない
* 他レコードとの重複禁止

#### MXレコード

* 優先度を明示
* DR用MXは必ず定義

#### TXTレコード

* SPF/DKIM/DMARC用途を明記
* 記載内容は設計書に全文記載

---

## 5. TTL設計

### 5.1 TTL基準値

| 用途    | TTL     |
| ----- | ------- |
| 通常運用  | 3600    |
| 切替・移行 | 300     |
| NS    | 86400以上 |

### 5.2 TTL運用ルール

* 切替前〇日前にTTL短縮
* 切替完了後、段階的にTTL復旧

---

## 6. セキュリティ設計（DNSレベル）

### 6.1 セキュリティ対策

| 項目     | 内容                    |
| ------ | --------------------- |
| DNSSEC | Publicゾーンは有効化         |
| ゾーン転送  | TSIG＋許可制              |
| 内部DNS  | Private Hosted Zone使用 |

---

### 6.2 不要レコード管理

* 未使用レコードは定期棚卸し
* テスト用レコードの本番残存禁止

---

## 7. DNS変更・削除ルール

### 7.1 変更フロー

1. 変更申請
2. 設計書差分レビュー
3. 作業実施
4. 疎通確認
5. 作業完了報告

---

### 7.2 削除ルール

* 削除前に **影響範囲明示**
* 削除後〇日間は旧値保持（ロールバック用）

---

## 8. 障害・切戻し設計

### 8.1 想定障害

| 障害      | 対応       |
| ------- | -------- |
| 名前解決不可  | NS切戻し    |
| 一部利用者不通 | TTL待ち＋検証 |

---

### 8.2 切戻し方針

* 旧DNSレコード即時復旧可能
* NS切替は最終手段

---

## 9. 監査・証跡対応

* DNS変更履歴保存（作業日時・作業者・差分）
* Route53変更ログ（CloudTrail）保存
* 年次監査対応資料作成

---

## 10. 付録

### 10.1 dig確認コマンド例

```
dig www.example.com
dig example.com NS
```

### 10.2 用語集

* TTL / FQDN / 権威DNS など

---

## まとめ（金融向け設計の要点）

* **DNSはアプリより先に止まる**
* レコード設計は「技術」ではなく「統制」
* TTL・承認・切戻しが最重要

---

# Route53 × BIND レコード管理ルール表

以下は、**金融・公共向けにそのまま運用設計書として使える
「Route53 × BIND レコード管理ルール表」**です。
**責任分界・変更統制・監査対応**を重視した内容になっています。

---

DNSレコード管理ルール表（金融・公共向け）

## 1. 管理分界ルール（最重要）

### 1.1 権威DNSの責任分界

| 項目    | Route53             | BIND（オンプレ）       |
| ----- | ------------------- | ---------------- |
| 権威DNS | パブリック／AWS内部         | 社内内部             |
| 対象ゾーン | example.com         | corp.example.com |
| 外部公開  | 〇                   | ×                |
| 内部限定  | Private Hosted Zone | 〇                |
| 冗長性   | AWSマネージド            | 自前構築             |

**原則**

* **外部公開ゾーンはRoute53のみ**
* BINDは内部系に限定

---

## 2. レコード種別ごとの管理ルール

| レコード  | Route53 | BIND | 備考        |
| ----- | ------- | ---- | --------- |
| SOA   | AWS管理   | 管理対象 | BINDは手動更新 |
| NS    | 管理対象    | 管理対象 | 切替時のみ     |
| A     | 管理対象    | 管理対象 | IP直指定は最小限 |
| AAAA  | 原則禁止    | 条件付き | IPv6可否要確認 |
| CNAME | 管理対象    | 管理対象 | 共存禁止注意    |
| Alias | 管理対象    | ×    | Route53専用 |
| MX    | 管理対象    | 管理対象 | 誤設定即影響    |
| TXT   | 管理対象    | 管理対象 | SPF/DKIM  |
| PTR   | ×       | 管理対象 | 逆引き       |

---

## 3. 登録ルール（共通）

| 項目     | ルール           |
| ------ | ------------- |
| FQDN命名 | 環境識別子明示       |
| TTL    | 通常3600／切替時300 |
| コメント   | 設計書番号必須       |
| 重複     | 重複禁止          |

---

## 4. Route53専用運用ルール

### 4.1 レコード登録

| 項目           | ルール              |
| ------------ | ---------------- |
| Alias使用      | ALB/CloudFront必須 |
| ヘルスチェック      | フェイルオーバー時必須      |
| Private Zone | VPC関連付け管理        |
| IAM権限        | 最小権限             |

---

### 4.2 変更制御

| 項目   | 内容           |
| ---- | ------------ |
| 承認   | 本番2名以上       |
| ログ   | CloudTrail必須 |
| 作業時間 | 業務時間外        |

---

## 5. BIND専用運用ルール

### 5.1 レコード管理

| 項目   | ルール         |
| ---- | ----------- |
| 管理方法 | zoneファイル    |
| 更新   | 手動編集        |
| シリアル | 必ず更新        |
| 反映   | rndc reload |

---

### 5.2 ゾーン転送

| 項目   | ルール    |
| ---- | ------ |
| AXFR | 原則禁止   |
| IXFR | TSIG必須 |
| 許可   | IP制限   |

---

## 6. 変更・削除ルール（重要）

### 6.1 変更フロー

1. 変更申請
2. 影響調査
3. 承認
4. 作業
5. 検証
6. 証跡保存

---

### 6.2 削除ルール

| 項目   | ルール      |
| ---- | -------- |
| 削除前  | 利用有無確認   |
| 保持   | 旧値〇日保存   |
| 緊急削除 | 事後レビュー必須 |

---

## 7. 並行運用ルール（移行・切替時）

| 項目  | 内容   |
| --- | ---- |
| NS  | 並行設定 |
| TTL | 事前短縮 |
| 切替  | 段階実施 |
| 切戻し | 即時可  |

---

## 8. 監査・証跡管理

| 項目   | Route53    | BIND  |
| ---- | ---------- | ----- |
| 変更履歴 | CloudTrail | Git管理 |
| 作業者  | IAM        | OSユーザ |
| 保存期間 | 〇年         | 〇年    |

---

## 9. 禁止事項（金融向け）

* 本番DNSの直接修正（申請なし）
* TTL未考慮の即時変更
* コメントなしレコード
* テスト用レコード残存

---

## 10. 付録：確認コマンド

```
dig example.com A
dig example.com NS
dig @ns1.example.com www.example.com
```

---

## まとめ（運用の要点）

* **Route53＝外部・AWS／BIND＝内部**
* レコード管理は「技術」より「統制」
* DNSは最後に切替、最初に戻す

---
