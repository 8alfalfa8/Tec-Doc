# DNS切替・移行計画書（TTL／並行稼働／切戻し）【金融向け】

## 1. 文書概要

### 1.1 目的

本書は、金融・公共系システムにおけるDNS切替および移行を、安全かつ業務影響を最小化して実施するための計画・手順・切戻し方針を定義する。

### 1.2 適用範囲

* 外部公開DNS（Route53 Public）
* 内部DNS（BIND / Unbound）
* オンプレミス → AWS移行

### 1.3 前提・制約

* 24/365運用
* 無停止または業務影響最小化
* FISC安全対策基準準拠

---

## 2. 移行方針

### 2.1 基本方針

* TTL制御による影響最小化
* 並行稼働による段階切替
* 即時切戻し可能な構成

### 2.2 移行方式

| 方式   | 採用 | 理由     |
| ---- | -- | ------ |
| 一括切替 | ×  | リスク高   |
| 段階切替 | ○  | 影響限定   |
| 並行稼働 | ○  | 即時切戻し可 |

---

## 3. TTL設計（最重要）

### 3.1 TTL変更方針

| フェーズ | TTL      |
| ---- | -------- |
| 通常運用 | 3600秒    |
| 移行準備 | 300秒     |
| 切替当日 | 60–300秒  |
| 移行完了 | 3600秒へ復旧 |

### 3.2 TTL変更対象

* A / AAAA / CNAME / NS
* SOA Minimum TTL

---

## 4. 並行稼働設計

### 4.1 並行稼働方式

| 種別     | 内容          |
| ------ | ----------- |
| DNS並行  | 旧DNS・新DNS両立 |
| システム並行 | 旧／新システム稼働   |

### 4.2 NSレベル並行

* NSに旧DNS／新DNSを同時登録
* 段階的に旧DNSを除外

---

## 5. 切替手順（本番）

### 5.1 事前準備（T-7〜3日）

1. TTL短縮（3600 → 300）
2. 新DNS環境構築完了
3. 並行疎通試験

### 5.2 切替当日（T0）

1. 監視強化体制
2. レコード切替（Route53/BIND）
3. digによる即時確認

### 5.3 切替後確認（T+0〜1日）

* 応答時間
* NXDOMAIN率
* アプリ疎通

---

## 6. 切戻し設計（重要）

### 6.1 切戻し判断基準

| 条件     | 判断   |
| ------ | ---- |
| 名前解決不可 | 即切戻し |
| 遅延多発   | 状況判断 |
| 一部影響   | 並行維持 |

### 6.2 切戻し手順

1. 旧DNSをNS優先へ復旧
2. レコードを旧値へ戻す
3. TTL短縮状態維持

---

## 7. リスク管理

### 7.1 想定リスク

* TTL未反映
* キャッシュ残存
* 一部ISP遅延

### 7.2 対策

* 十分なTTL短縮期間
* 並行稼働維持

---

## 8. 監視・体制

### 8.1 当日体制

| 役割    | 内容    |
| ----- | ----- |
| 統括    | 判断・承認 |
| DNS担当 | 設定変更  |
| 監視担当  | 影響確認  |

### 8.2 監視項目

* DNS応答
* アプリ疎通
* CloudWatch / Zabbix

---

## 9. 監査対応ポイント

| 観点    | 説明      |
| ----- | ------- |
| 影響最小化 | TTL制御   |
| 即時復旧  | 切戻し手順明確 |
| 証跡    | 作業記録    |

---

## 10. 成果物

* DNS切替計画書
* 作業手順書
* 作業結果報告書

---

## 11. 付録

### 11.1 確認コマンド

```
dig example.com @8.8.8.8
dig example.com @1.1.1.1
```

### 11.2 チェックリスト

* [ ] TTL短縮
* [ ] 並行疎通確認
* [ ] 切戻し確認

---

# ◆ 本計画書についての説明

本計画書は **FISC・ISMAP監査でそのまま説明できる構成** を意識しており、
「なぜ安全に切り替えられるのか」「なぜ即時に戻せるのか」を
**TTL・並行・切戻し** の3点で論理的に示しています。

---

## 本計画書の実務的な強み

### ✅ 金融向けDNS切替で最重要な論点を網羅

* **TTL設計をフェーズ別に明文化**
* **NS並行登録によるDNSレベル冗長**
* 「切戻し判断基準」を定義（属人化排除）
* 切替当日の **体制・監視・承認フロー** 明示

### ✅ 監査で評価されやすいポイント

| 監査観点 | 本書での担保    |
| ---- | --------- |
| 無停止性 | 並行稼働      |
| 迅速復旧 | TTL短縮＋切戻し |
| 統制   | 役割分担・記録   |
| 再現性  | 手順化       |

---

## よくある失敗と本書での回避策

| 失敗例        | 回避策      |
| ---------- | -------- |
| TTL短縮が遅い   | T-7日から実施 |
| ISPキャッシュ残存 | 並行稼働維持   |
| 判断遅延       | 切戻し条件明確化 |
| 夜間属人対応     | 体制定義     |

---

