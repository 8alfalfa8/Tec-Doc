# DNS詳細設計書

## 1. 文書概要

### 1.1 目的

本書は、Linux環境におけるDNS（Domain Name System）サーバの詳細設計を定義し、構築・運用・監査対応を一貫して実施可能とすることを目的とする。

### 1.2 適用範囲

* オンプレミス／クラウド（IaaS）環境
* 内部DNS／外部DNS
* 金融・公共系システムを含む

### 1.3 参照資料

* RFC1034 / RFC1035
* RFC4033–4035（DNSSEC）
* システム基本設計書

---

## 2. 全体アーキテクチャ設計

### 2.1 論理構成

* キャッシュDNS（Unbound）
* 権威DNS（BIND9）
* 上位DNS（ISP / Route53等）

### 2.2 物理構成

| サーバ名         | 役割       | OS    | 配置   |
| ------------ | -------- | ----- | ---- |
| dns-cache-01 | キャッシュDNS | RHEL9 | DC-A |
| dns-cache-02 | キャッシュDNS | RHEL9 | DC-B |
| dns-auth-01  | 権威DNS    | RHEL9 | DC-A |
| dns-auth-02  | 権威DNS    | RHEL9 | DC-B |

---

## 3. ネットワーク設計

### 3.1 IP/ポート設計

| 種別  | ポート        | 通信元       | 通信先       |
| --- | ---------- | --------- | --------- |
| DNS | UDP/TCP 53 | Client    | Cache DNS |
| DNS | UDP/TCP 53 | Cache DNS | Auth DNS  |

### 3.2 Firewall要件

* UDP/TCP 53 のみ許可
* 再帰問い合わせは内部NW限定

---

## 4. DNSゾーン設計

### 4.1 管理ゾーン一覧

| ゾーン名                   | 種別  | 公開範囲 |
| ---------------------- | --- | ---- |
| example.com            | 正引き | 外部   |
| internal.example.com   | 正引き | 内部   |
| 1.168.192.in-addr.arpa | 逆引き | 内部   |

### 4.2 レコード設計方針

* TTL標準値：3600秒
* 変更作業前は300秒へ一時変更

---

## 5. サーバ設定設計（BIND）

### 5.1 named.conf設計

* recursion：no
* allow-query：any
* version：非表示

### 5.2 ゾーン転送設計

| 項目  | 内容        |
| --- | --------- |
| 方式  | AXFR/IXFR |
| 認証  | TSIG      |
| 転送先 | スレーブDNSのみ |

---

## 6. キャッシュDNS設計（Unbound）

### 6.1 再帰制御

* 内部NWのみ許可

### 6.2 セキュリティ設定

* hide-identity：有効
* rate-limit：有効

---

## 7. 冗長化・可用性設計

### 7.1 冗長方式

* マルチNS構成
* 異拠点配置

### 7.2 障害時挙動

* 片系停止時も名前解決継続

---

## 8. セキュリティ設計

### 8.1 セキュリティ要件

| 項目     | 対応        |
| ------ | --------- |
| DNSSEC | 対応（外部ゾーン） |
| 再帰制御   | 内部限定      |
| ログ取得   | 有効        |

---

## 9. 運用設計

### 9.1 定常運用

* レコード管理
* ログ監視
* パッチ適用

### 9.2 変更管理

* 変更申請書
* 事前影響調査
* 作業結果記録

---

## 10. 監視設計

### 10.1 監視項目

| 項目   | 閾値     |
| ---- | ------ |
| 応答時間 | 100ms  |
| プロセス | 稼働     |
| ポート  | Listen |

---

## 11. 障害対応設計

### 11.1 想定障害

* 名前解決不可
* 応答遅延

### 11.2 初動対応

1. プロセス確認
2. ログ確認
3. dig確認

---

## 12. テスト設計

### 12.1 構築時テスト

* 正引き／逆引き確認
* 冗長切替確認

### 12.2 定期テスト

* 月次疎通試験

---

## 13. 移行・切替設計

* TTL短縮
* 並行稼働
* 切戻し手順

---

## 14. 付録

### 14.1 コマンド一覧

* dig
* nslookup
* rndc

### 14.2 用語集

* SOA
* TTL
* AXFR




