# ◆ インフラにおける「核心的サービス」

**インフラ構築における「核心的（＝止まると全体が成立しない）」サービス／技術**を、
**オンプレミス／AWS／GCP／OCI** 単位で、**役割・なぜ核心か・設計／構築の要点**まで踏み込んで体系的に整理します。
（※金融・公共レベルの厳格設計を前提にしています）

---

## 1. インフラにおける「核心的サービス」とは

まず前提定義です。

| 観点  | 内容                                |
| --- | --------------------------------- |
| 定義  | **全システムが依存し、障害時の影響範囲が最大**         |
| 特徴  | 横断的（全サーバ・全アプリが参照）                 |
| 例   | DNS / 認証 / ネットワーク / 時刻 / ログ / 証明書 |
| 失敗時 | 全サービス停止、もしくは復旧困難                  |

👉 **アプリよりも先に設計すべき領域**です。

---

## 2. 核心的インフラ技術（全環境共通の分類）

まず共通軸を整理します。

| 分類       | 核心サービス例               |
| -------- | --------------------- |
| 名前解決     | DNS                   |
| ネットワーク   | L3/L4/L7、ルーティング       |
| 認証・認可    | AD / LDAP / IAM       |
| セキュリティ境界 | FW / WAF / セキュリティグループ |
| 証明書      | PKI / TLS             |
| 時刻       | NTP                   |
| ログ・監査    | Syslog / Audit Log    |
| 可用性      | 冗長化 / フェイルオーバー        |
| 構成管理     | IaC / CM              |
| 監視       | メトリクス / アラート          |

これを環境別に具体化します。

---

## 3. オンプレミス（データセンター）における核心技術

### 3.1 DNS（最重要）

#### 役割

* 全サーバ・アプリの名前解決
* AD / 認証 / API / 外部連携の基盤

#### 技術

* **BIND**
* **Windows DNS（AD統合）**

#### 設計ポイント

* 内部DNS / 外部DNS 分離
* マスター／スレーブ冗長
* DNSSEC（公共・金融）
* 変更管理（ゾーン更新ルール）

👉 **DNS障害＝全システム通信不能**

---

### 3.2 ネットワーク（L2/L3/L4）

#### 技術

* VLAN
* ルータ（BGP/OSPF）
* 冗長FW（Active-Standby）

#### 核心理由

* セグメント設計＝セキュリティ境界
* ルーティング誤り＝全断

---

### 3.3 認証基盤

| 技術               | 用途     |
| ---------------- | ------ |
| Active Directory | OSログイン |
| LDAP             | アプリ認証  |
| Kerberos         | SSO    |

👉 **認証が落ちると運用作業すら不能**

---

### 3.4 時刻同期（NTP）

* 内部NTP → 外部Stratum連携
* 監査ログの正当性確保

---

### 3.5 ログ・監査

* Syslog
* SIEM（Splunk等）
* 操作証跡（root / admin）

---

## 4. AWS における核心サービス

### 4.1 Route53（DNS）

#### なぜ核心か

* ALB / API / PrivateLink すべてが依存

#### 構成

| 機能                  | 内容          |
| ------------------- | ----------- |
| Public Hosted Zone  | 外部公開        |
| Private Hosted Zone | VPC内部       |
| Health Check        | DNSフェイルオーバー |

👉 **オンプレDNSからの移行時に最も事故が多い**

---

### 4.2 VPC（ネットワークの心臓）

| 要素         | 内容     |
| ---------- | ------ |
| CIDR       | 全体IP設計 |
| Subnet     | AZ分離   |
| RouteTable | 通信制御   |
| IGW / NAT  | 外部接続   |

**VPC設計ミス＝作り直し**

---

### 4.3 IAM（認証・認可の中枢）

#### 役割

* 人・アプリ・CI/CDすべての権限制御

#### 核心理由

* 過剰権限＝即インシデント
* 不足権限＝運用停止

---

### 4.4 セキュリティ境界

* Security Group（L4）
* NACL（L3）
* WAF（L7）

---

### 4.5 ログ・監査

| サービス            | 役割     |
| --------------- | ------ |
| CloudTrail      | 操作証跡   |
| CloudWatch Logs | アプリ/OS |
| GuardDuty       | 脅威検知   |

---

## 5. GCP における核心サービス

### 5.1 Cloud DNS

* マネージドDNS
* VPC Peering連携

AWS Route53と思想は近いが
👉 **VPC設計と強く結合**

---

### 5.2 VPC（グローバルVPC）

#### 特徴

* リージョンを跨ぐ単一VPC
* サブネットがリージョン単位

👉 AWS設計思想と真逆なので事故りやすい

---

### 5.3 IAM（GCP IAM）

* プロジェクト／フォルダ階層
* Roleベースが極端に強い

---

### 5.4 ログ・監査

* Cloud Audit Logs
* Cloud Logging
* Security Command Center

---

## 6. OCI（Oracle Cloud）における核心サービス

### 6.1 OCI DNS

* Private DNS（VCN内）
* On-Prem連携用途が多い

---

### 6.2 VCN（Virtual Cloud Network）

| 要素     | AWS対応  |
| ------ | ------ |
| VCN    | VPC    |
| Subnet | Subnet |
| DRG    | VGW    |

👉 **Oracle DB接続前提の設計が核心**

---

### 6.3 IAM

* Compartment設計が超重要
* リソース境界＝Compartment

---

### 6.4 FastConnect / VPN

* オンプレOracle環境との専用線前提構成が多い

---

## 7. 環境横断で特に重要な「三大核心」

最後に**本当に失敗すると致命的な三つ**を明示します。

| 順位 | サービス            | 理由     |
| -- | --------------- | ------ |
| ①  | DNS             | 全通信の前提 |
| ②  | ネットワーク（VPC/VCN） | 後戻り不可  |
| ③  | 認証（IAM/AD）      | 運用不能   |

👉 **この3つは「後から考える」はNG**

---

# ◆ インフラ核心サービス比較一覧（オンプレ / AWS / GCP / OCI）

## 1. 全体俯瞰（まずこの表）

| 分類      | オンプレミス    | AWS     | GCP     | OCI        |
| ------- | --------- | ------- | ------- | ---------- |
| 基本思想    | 自由設計・自己責任 | マネージド前提 | グローバル統合 | Oracle連携最適 |
| 障害責任    | 利用者       | 共同責任    | 共同責任    | 共同責任       |
| 設計難易度   | 非常に高      | 高       | 高（思想差）  | 中～高        |
| 作り直し難易度 | 物理的に困難    | 非常に困難   | 非常に困難   | 困難         |

---

## 2. DNS（最重要・最上流）

| 観点    | オンプレ          | AWS                 | GCP          | OCI         |
| ----- | ------------- | ------------------- | ------------ | ----------- |
| サービス  | BIND / AD DNS | Route53             | Cloud DNS    | OCI DNS     |
| 管理対象  | サーバ管理         | フルマネージド             | フルマネージド      | マネージド       |
| 内部DNS | 自前構築          | Private Hosted Zone | Private Zone | Private DNS |
| 外部DNS | 自前            | Public Hosted Zone  | Public Zone  | Public DNS  |
| 冗長化   | 手動            | 標準                  | 標準           | 標準          |
| 核心理由  | 全通信の前提        | ALB/API依存           | VPC依存        | VCN依存       |
| 事故例   | ゾーン破損         | PHZ誤紐付              | VPC誤参照       | DRG連携失敗     |

👉 **DNS設計はすべての起点**

---

## 3. ネットワーク（VPC/VCN/L3）

| 観点       | オンプレ       | AWS        | GCP        | OCI        |
| -------- | ---------- | ---------- | ---------- | ---------- |
| 論理NW     | VLAN / VRF | VPC        | VPC（グローバル） | VCN        |
| IP設計     | 完全自由       | CIDR固定     | CIDR固定     | CIDR固定     |
| ルーティング   | 動的/静的      | RouteTable | 自動＋静的      | RouteTable |
| AZ/リージョン | DC依存       | AZ分離       | リージョン跨ぎ    | AD分離       |
| 作り直し     | 不可         | ほぼ不可       | ほぼ不可       | 困難         |
| 特徴       | 柔軟だが重い     | 標準化        | 思想が独特      | Oracle前提   |

👉 **IP設計ミス＝詰み**

---

## 4. 認証・認可（運用の生命線）

| 観点   | オンプレ      | AWS          | GCP            | OCI            |
| ---- | --------- | ------------ | -------------- | -------------- |
| 中心技術 | AD / LDAP | IAM          | IAM            | IAM            |
| 認証対象 | 人/サーバ     | 人/サービス       | 人/サービス         | 人/サービス         |
| 権限単位 | グループ      | Policy       | Role           | Policy         |
| SSO  | Kerberos  | IAM Identity | Cloud Identity | OCI IAM        |
| 核心理由 | 管理者ログイン   | 全操作依存        | 全操作依存          | 全操作依存          |
| 事故例  | AD停止      | 過剰権限         | Role設計不良       | Compartment誤設計 |

---

## 5. セキュリティ境界（防御線）

| 観点    | オンプレ  | AWS       | GCP         | OCI           |
| ----- | ----- | --------- | ----------- | ------------- |
| L3/L4 | FW    | SG / NACL | FW Rule     | Security List |
| L7    | WAF   | AWS WAF   | Cloud Armor | OCI WAF       |
| 境界設計  | 物理/論理 | リソース単位    | VPC単位       | VCN単位         |
| 特徴    | 重厚    | 最小単位制御    | 自動連携        | Oracle向き      |

---

## 6. 時刻同期（監査必須）

| 観点  | オンプレ | AWS              | GCP        | OCI     |
| --- | ---- | ---------------- | ---------- | ------- |
| NTP | 自前   | Amazon Time Sync | Google NTP | OCI NTP |
| 設定  | 明示   | 自動               | 自動         | 自動      |
| 重要性 | 高    | 高                | 高          | 高       |

---

## 7. ログ・監査（金融・公共の核心）

| 観点    | オンプレ   | AWS        | GCP              | OCI            |
| ----- | ------ | ---------- | ---------------- | -------------- |
| 操作ログ  | Syslog | CloudTrail | Audit Logs       | Audit          |
| 監視    | Zabbix | CloudWatch | Cloud Monitoring | OCI Monitoring |
| 改ざん防止 | SIEM   | S3 + Lock  | Log Bucket       | Object Storage |
| 監査対応  | 個別設計   | 標準対応       | 標準対応             | 標準対応           |

---

## 8. 可用性・冗長化

| 観点   | オンプレ | AWS   | GCP   | OCI      |
| ---- | ---- | ----- | ----- | -------- |
| 冗長単位 | 機器   | AZ    | リージョン | AD       |
| 切替方式 | 手動多  | 自動    | 自動    | 自動       |
| DR   | 高コスト | 比較的容易 | 容易    | Oracle特化 |

---

## 9. IaC・構成管理（現代必須）

| 観点   | オンプレ    | AWS             | GCP       | OCI       |
| ---- | ------- | --------------- | --------- | --------- |
| IaC  | Ansible | Terraform / CDK | Terraform | Terraform |
| 手動構築 | 多い      | 非推奨             | 非推奨       | 非推奨       |
| 監査適合 | 難       | 容易              | 容易        | 容易        |

---

## 10. 「特に注意すべき核心差分」まとめ

| 項目  | 最大の違い           |
| --- | --------------- |
| DNS | オンプレは自前、クラウドは統合 |
| NW  | GCPはグローバルVPC    |
| 認証  | クラウドはIAM設計が全て   |
| 境界  | 物理FW → 論理FW     |
| 監査  | クラウドは標準装備       |

---

## 11. 実務での使い方（重要）

* **RFPレビュー**：この表で抜け漏れ確認
* **移行設計**：オンプレ→クラウド差分説明
* **設計レビュー**：「DNS/IAM/VPCは先に固めたか？」

---

# ◆ インフラ構築における核心サービス構成図

ポイントは以下です。

* **論理構成＋制御点＋監査点**を明示
* 「なぜこの箱が必要か」を設計思想として含める
* **障害・不正・誤操作を前提**にした分離と冗長

---

## 1. 金融・公共向け 詳細設計の前提原則

まず全環境共通の原則です。

| 原則   | 内容                   |
| ---- | -------------------- |
| 分離   | 利用者／管理者／システムを分離      |
| 最小権限 | IAM・NWともに deny first |
| 多層防御 | DNS / NW / 認証 / L7   |
| 証跡必須 | 操作・通信・設定変更           |
| 冗長前提 | 単一障害点を許容しない          |

---

## 2. オンプレミス（金融・公共向け）詳細設計構成図

```
                 ┌─────────────────────────┐
                 │ 外部DNS（委託/自前）      │
                 │ DNSSEC有効               │
                 └───────────┬─────────────┘
                             │
                 ┌───────────▼─────────────┐
                 │ 外部FW（DMZ境界）        │
                 │ A/S冗長・変更管理必須     │
                 └───────────┬─────────────┘
                             │
        ┌────────────────────▼────────────────────┐
        │                DMZゾーン                 │
        │  ・公開向け名前解決                       │
        │  ・WAF / L7制御                          │
        └───────────┬─────────────────────────────┘
                     │
        ┌───────────▼─────────────────────────────┐
        │ 内部FW（業務NW境界）                      │
        │ ・管理NW / 業務NW 分離                   │
        └───────────┬─────────────────────────────┘
                     │
        ┌───────────▼─────────────────────────────┐
        │ コアNW（L3）                             │
        │ ・VLAN/VRF                              │
        │ ・動的ルーティング                        │
        │ ・NW変更はCAB管理                        │
        └───────┬───────────────┬─────────────────┘
                │               │
   ┌────────────▼────┐  ┌───────▼──────────┐
   │ 内部DNS         │  │ 認証基盤          │
   │ BIND/AD DNS     │  │ AD/LDAP          │
   │ ・Master/Slave  │  │ ・特権ID分離      │
   │ ・更新承認制     │  │ ・MFA            │
   └─────────────────┘  └──────────────────┘
                │
        ┌───────▼─────────┐
        │ 内部NTP          │
        │ Stratum階層管理  │
        └─────────────────┘

        ┌─────────────────────────────────────┐
        │ ログ・監査基盤                       │
        │ ・Syslog集中                        │
        │ ・操作証跡                           │
        │ ・改ざん検知                         │
        └─────────────────────────────────────┘
```

### 金融・公共向け設計要点

* **DNS更新は必ず承認制**
* **管理NWは業務NWと物理/論理分離**
* AD管理者＝全権のため**多重統制必須**

---

## 3. AWS（金融・公共向け）詳細設計構成図

```
        ┌─────────────────────────────────────┐
        │ Route53 Public Hosted Zone          │
        │ ・DNSSEC                            │
        │ ・HealthCheck                       │
        └──────────────┬──────────────────────┘
                       │
        ┌──────────────▼──────────────────────┐
        │ Route53 Private Hosted Zone         │
        │ ・VPC限定                            │
        │ ・外部解決禁止                       │
        └──────────────┬──────────────────────┘
                       │
┌──────────────────────▼───────────────────────────────────┐
│                        VPC                               │
│  CIDR固定／変更不可                                       │
│                                                          │
│  ┌──────────────┐   ┌──────────────┐                     │
│  │ 管理Subnet   │   │ 業務Subnet    │                     │
│  │ Bastion/SSM  │   │ App/DB       │                     │
│  └──────────────┘   └──────────────┘                     │
│                                                          │
│  ┌────────────────────────────────────────────────────┐  │
│  │ セキュリティ境界                                     │ │
│  │ ・SecurityGroup（最小単位）                          │ │
│  │ ・NACL（通信制御）                                   │ │
│  │ ・WAF（L7）                                         │ │
│  └────────────────────────────────────────────────────┘  │
│                                                          │
│  ┌────────────────────────────────────────────────────┐  │
│  │ IAM（最重要）                                       │  │
│  │ ・管理者/運用者/CI/CD完全分離                        │  │
│  │ ・Role前提                                          │  │
│  │ ・MFA必須                                           │  │
│  └────────────────────────────────────────────────────┘  │
└──────────────────────┬───────────────────────────────────┘
                       │
        ┌──────────────▼──────────────────────┐
        │ Amazon Time Sync Service            │
        └─────────────────────────────────────┘

        ┌──────────────────────────────────────┐
        │ ログ・監査                            │
        │ ・CloudTrail (全リージョン)           │
        │ ・S3 ObjectLock                      │
        │ ・GuardDuty                          │
        └──────────────────────────────────────┘
```

### 金融・公共向け設計要点

* **IAMが最大のリスク**
* CloudTrailは**削除不可構成**
* 管理操作はSSM経由のみ（踏み台廃止）

---

## 4. GCP（金融・公共向け）詳細設計構成図

```
┌────────────────────────────────────────────────────┐
│ Organization                                       │
│ ・監査ログ強制                                      │
└──────────────┬─────────────────────────────────────┘
               │
┌──────────────▼─────────────────────────────────────┐
│ Folder（システム単位）                               │
│ ・権限境界                                          │
└──────────────┬─────────────────────────────────────┘
               │
┌──────────────▼─────────────────────────────────────┐
│ Project                                            │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ Cloud DNS (Public/Private)                   │  │
│  └──────────────────────────────────────────────┘  │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ Global VPC                                   │  │
│  │ ・Firewall集中管理                            │  │
│  │ ・Subnet（Region単位）                        │  │
│  └──────────────────────────────────────────────┘  │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ IAM (Role中心)                                │  │
│  │ ・継承ルール厳格                               │  │
│  │ ・組織ポリシー必須                             │  │
│  └──────────────────────────────────────────────┘  │
└──────────────┬─────────────────────────────────────┘
               │
        ┌──────▼─────────┐
        │ Google NTP     │
        └────────────────┘

        ┌─────────────────────────────────────┐
        │ ログ・監査                           │
        │ ・Audit Logs（必須）                 │
        │ ・SCC                               │
        └─────────────────────────────────────┘
```

### 金融・公共向け設計要点

* **IAM継承事故が最多**
* Org Policyで制限しないと破綻
* VPCは「共有 or 非共有」を最初に決定

---

## 5. OCI（金融・公共向け）詳細設計構成図

```
┌────────────────────────────────────────────────────┐
│ Tenancy                                            │
│ ・全操作監査                                        │
└──────────────┬─────────────────────────────────────┘
               │
┌──────────────▼─────────────────────────────────────┐
│ Compartment(システム境界)                           │
│ ・権限完全分離                                      │
└──────────────┬─────────────────────────────────────┘
               │
┌──────────────▼─────────────────────────────────────┐
│ VCN                                                │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ OCI DNS (Private)                            │  │
│  └──────────────────────────────────────────────┘  │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ Subnet / RouteTable                          │  │
│  │ Security List / NSG                          │  │
│  └──────────────────────────────────────────────┘  │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ DRG / FastConnect / VPN                      │  │
│  │ (オンプレOracle連携)                          │  │
│  └──────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────┘

        ┌─────────────────────────────────────┐
        │ ログ・監査                           │
        │ OCI Audit / Object Storage          │
        └─────────────────────────────────────┘
```

### 金融・公共向け設計要点

* **Compartment設計＝IAM設計**
* Oracle DB監査要件と一体設計
* 専用線前提構成が多い

---

## 6. 金融・公共向け「核心レビュー観点チェック」

| 観点  | 質問                |
| --- | ----------------- |
| DNS | 誰が・どう承認して変更する？    |
| NW  | 管理通信は業務と分離されているか？ |
| IAM | 全特権操作は追跡可能か？      |
| ログ  | 削除・改ざんは物理的に不可能か？  |
| 復旧  | DNS/IAM障害時の復旧手順は？ |

---

## 実務向けの作業着手

* **設計書章立て**
* **FISC/ISMAP対応チェックリスト**
* **オンプレ→クラウド移行 Before/After図**

---

