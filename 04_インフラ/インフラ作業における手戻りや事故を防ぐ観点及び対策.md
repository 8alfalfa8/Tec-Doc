# ◆ インフラ作業における手戻りや事故を防ぐ観点及び対策

インフラ作業（オンプレ／クラウド問わず）における**手戻り・障害事故の主因は**「**設計不備・前提誤認・変更統制不足・検証不足**」です。
特に、あなたが多く扱われている **AWS移行・IaC（Terraform）・金融／公共案件レベル**では、軽微な設定ミスが重大インシデントに直結します。

以下、**原因構造 → 具体的対策（工程別）→ 実務テンプレ観点 → 事故パターン別防止策**の順で体系化します。

---

## 1. 手戻り・事故の主要原因構造

### ① 要件・前提誤認

* 非機能要件未確定（可用性、RTO/RPO、監査）
* 既存構成の把握不足
* NW/セキュリティ制約の見落とし

→ 設計やり直し、性能不足、通信断発生

---

### ② 設計粒度不足

* ポート番号未定義
* DNS切替手順曖昧
* IAM権限の具体化不足
* 例外系未考慮

→ 構築後に差戻し

---

### ③ 変更管理不足

* 口頭指示のみ
* 設計書未更新
* 本番反映手順未レビュー

→ 本番障害

---

### ④ 環境差異

* 開発と本番の構成差
* 手作業設定混入
* IaC未使用

→ 再現不可事故

---

### ⑤ 試験不足

* 冗長切替未検証
* 障害注入未実施
* 性能試験未実施

→ 本番で初検出

---

## 2. 工程別：事故防止の具体策

---

### 【① 要件定義フェーズ】

#### 防止観点

* 非機能要件を数値化
* 境界明確化（責任分界）

#### 実施策

* 可用性目標（例：99.99%）
* RTO/RPO明文化
* バックアップ保存期間明確化
* NW責任範囲図作成

#### 成果物例

* 非機能要件一覧
* 責任分界図
* 接続一覧表

---

### 【② 基本設計フェーズ】

#### 防止観点

* 曖昧語排除
* 全通信明文化
* 冗長構成図示

#### 実施策

* ポート番号一覧表
* ルーティング一覧
* IAMポリシー定義
* DNSレコード設計

---

### 【③ 詳細設計フェーズ】

#### 防止観点

* パラメータ全列挙
* 異常系定義
* ロールバック定義

#### 実施策

* パラメータシート（CIDR、AZ、インスタンスタイプ）
* 障害時挙動記載
* 切戻し手順明文化

---

### 【④ 構築フェーズ】

#### 防止観点

* 手作業排除
* 再現性確保

#### 実施策

* IaC利用（Terraform）
* Git管理
* PRレビュー必須化
* 変更差分確認

---

### 【⑤ 試験フェーズ】

#### 必須試験

| 試験       | 防止効果        |
| -------- | ----------- |
| 疎通試験     | FW/NACL誤り検出 |
| 冗長切替試験   | SPOF排除      |
| 障害注入試験   | 自動復旧確認      |
| 性能試験     | キャパ不足防止     |
| ロールバック試験 | 本番事故防止      |

---

### 3. インフラ事故の代表例と対策

---

#### ■ DNS切替事故

##### 原因

* TTL未調整
* 切替手順曖昧

##### 対策

* 事前TTL短縮
* 並行稼働確認
* 切替判定基準明確化

---

#### ■ セキュリティグループ誤設定

##### 原因

* ANY許可
* CIDR誤記

##### 対策

* 接続元一覧化
* レビュー観点表
* 自動Lintツール利用

---

#### ■ IAM過剰権限

##### 原因

* とりあえずAdmin

##### 対策

* 最小権限原則
* 権限棚卸
* CloudTrail監査

---

#### ■ 本番直変更事故

##### 原因

* 直接SSH
* 手作業修正

##### 対策

* Bastion制御
* IaC強制
* 変更申請フロー必須化

---

### 4. 組織的防止策（最重要）

---

#### ① 変更管理プロセス（CAB）

* 変更申請書
* リスク評価
* ロールバック記載
* 承認履歴保存

---

#### ② レビュー制度

| レビュー     | 対象       |
| -------- | -------- |
| 設計レビュー   | 通信・冗長・監査 |
| コードレビュー  | IaC      |
| 作業前リハーサル | 本番作業     |

---

#### ③ 作業当日統制

* タイムライン作成（分単位）
* 作業責任者1名固定
* 口頭指示禁止
* 作業ログ記録

---

### 5. IaC時代の事故防止高度化

あなたが経験されているTerraform前提で整理します。

---

#### ベストプラクティス

##### ■ Plan差分レビュー必須

```
terraform plan
```

→ 差分を第三者確認

---

##### ■ 本番直Apply禁止

* dev → stg → prod昇格制
* 承認フロー付きCI/CD

---

##### ■ State管理統制

* S3バックエンド + ロック
* State直接編集禁止

---

### 6. 金融・公共レベルの追加統制

* 二重承認
* 作業録画
* 監査ログ保存
* 変更履歴永久保存
* 休日夜間作業禁止

---

### 7. まとめ：事故を防ぐ原理

事故防止の本質は：

```
① 曖昧をなくす
② 手作業をなくす
③ レビューを制度化する
④ 異常系を事前に体験する
⑤ 記録を残す
```

---

### 8. 実務的チェックリスト（簡易版）

✔ 非機能数値化済み<br>
✔ 通信一覧作成済み<br>
✔ IaC化済み<br>
✔ planレビュー済み<br>
✔ ロールバック検証済み<br>
✔ 作業タイムライン作成済み<br>
✔ 切替判定基準明文化

---

