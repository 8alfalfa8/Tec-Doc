
# システム設定書及び設定パラメータシート

ここでは、**Spring Boot 3.4** を用いた Webアプリケーション開発における
「①システム設定書（設計書）」および「②設定パラメータシート（Excel想定構成）」の設計を示します。

---

## ① システム設定書（Spring Boot 3.4 システム構成・設定設計書）

### 1. 概要

| 項目        | 内容                                          |
| --------- | ------------------------------------------- |
| システム名     | Web業務アプリケーション                               |
| 開発フレームワーク | Spring Boot 3.4                             |
| 言語        | Java 17 or 21                               |
| ビルドツール    | Gradle または Maven                            |
| 実行環境      | Linux（Amazon Linux / Ubuntu）                |
| デプロイ方法    | Docker / Kubernetes（ECS, EKS, etc.）         |
| 外部連携      | REST API / DB / メッセージキュー / 認証基盤（Keycloakなど） |

---

### 2. システム構成図（論理構成例）

```
 ┌───────────────┐
 │  Web Browser  │
 └──────┬────────┘
        │ HTTPS
 ┌──────┴─────────────────────────────┐
 │       Spring Boot 3.4 (API層)      │
 │  - Controller                      │
 │  - Service                         │
 │  - Repository                      │
 │  - Security (Spring Security)      │
 └──────┬─────────────────────────────┘
        │ JPA / JDBC
 ┌──────┴─────────┐
 │   Database     │
 │ (PostgreSQL)   │
 └────────────────┘
```

---

### 3. 環境別設定概要

| 環境          | 設定方法                    | 備考                        |
| ----------- | ----------------------- | ------------------------- |
| 開発環境（local） | `application-local.yml` | IntelliJ / Docker Compose |
| ステージング環境    | `application-stg.yml`   | CI/CDで自動デプロイ              |
| 本番環境        | `application-prod.yml`  | Secrets Manager連携         |

---

### 4. 設定ファイル構造例

```
src/
 └ main/
    └ resources/
       ├─ application.yml
       ├─ application-local.yml
       ├─ application-stg.yml
       └─ application-prod.yml
```

---

### 5. Spring Boot 設定要素

| 分類       | 設定キー                                                    | 説明           | 設定例                                                                                              |
| -------- | ------------------------------------------------------- | ------------ | ------------------------------------------------------------------------------------------------ |
| サーバ      | `server.port`                                           | アプリの待受ポート    | 8080                                                                                             |
| DB接続     | `spring.datasource.url`                                 | JDBC接続URL    | jdbc:postgresql://db:5432/appdb                                                                  |
| DB接続     | `spring.datasource.username`                            | DBユーザ名       | appuser                                                                                          |
| DB接続     | `spring.datasource.password`                            | パスワード        | 環境変数またはVaultから取得                                                                                 |
| JPA      | `spring.jpa.hibernate.ddl-auto`                         | スキーマ管理モード    | none / update                                                                                    |
| JPA      | `spring.jpa.show-sql`                                   | SQLログ出力      | true（開発のみ）                                                                                       |
| ログ       | `logging.level.root`                                    | ログレベル        | INFO                                                                                             |
| ログ       | `logging.file.name`                                     | ログ出力ファイル名    | /var/log/app/app.log                                                                             |
| セキュリティ   | `spring.security.oauth2.resourceserver.jwt.jwk-set-uri` | JWT検証エンドポイント | [https://auth.example.com/.well-known/jwks.json](https://auth.example.com/.well-known/jwks.json) |
| メール      | `spring.mail.host`                                      | SMTPサーバ      | smtp.gmail.com                                                                                   |
| キャッシュ    | `spring.cache.type`                                     | キャッシュ方式      | caffeine / redis                                                                                 |
| 外部API    | `api.external.url`                                      | 外部APIエンドポイント | [https://api.partner.com](https://api.partner.com)                                               |
| メッセージキュー | `spring.kafka.bootstrap-servers`                        | Kafkaサーバ     | kafka:9092                                                                                       |
| CORS設定   | `app.cors.allowed-origins`                              | 許可ドメイン       | [https://frontend.example.com](https://frontend.example.com)                                     |

---

### 6. Spring Profile 管理方針

| 項目      | 内容                                           |
| ------- | -------------------------------------------- |
| プロファイル名 | local / stg / prod                           |
| 切替方法    | `-Dspring.profiles.active={profile}` または環境変数 |
| 優先順位    | コマンドライン > 環境変数 > application.yml             |

---

### 7. 環境変数管理ポリシー

| 変数名             | 用途        | 設定例  | 管理方法                     |
| --------------- | --------- | ---- | ------------------------ |
| `DB_PASSWORD`   | DB接続パスワード | **** | AWS Secrets Manager      |
| `JWT_SECRET`    | JWT署名秘密鍵  | **** | Vault or Parameter Store |
| `MAIL_PASSWORD` | SMTP認証パス  | **** | .envファイル（localのみ）        |

---

### 8. ログ・監視設計

| 対象    | ツール / 方法                  | 保存期間 | 備考             |
| ----- | ------------------------- | ---- | -------------- |
| アプリログ | logback / CloudWatch Logs | 30日  | 日次ローテート        |
| エラーログ | logback-error.log         | 90日  | 障害調査用          |
| メトリクス | Actuator / Prometheus     | 60日  | CPU / Memory監視 |
| トレース  | OpenTelemetry / Jaeger    | 7日   | 分散トレース         |

---

### 9. セキュリティ設計

| 区分      | 内容                                    |
| ------- | ------------------------------------- |
| 認証方式    | OAuth2 / JWT                          |
| 認可方式    | RBAC (Role-Based Access Control)      |
| 通信保護    | HTTPS（ALB / Nginx）                    |
| CSRF対策  | Spring Security有効化                    |
| 入力検証    | Bean Validation (@NotNull, @Pattern等) |
| パスワード保護 | BCryptによるハッシュ化                        |
| 脆弱性対策   | OWASP Top10対応チェック実施                   |

---

### 10. デプロイ・CI/CD設定

| 項目      | 内容                                    |
| ------- | ------------------------------------- |
| ビルド     | `./gradlew build`                     |
| コンテナ化   | Dockerfileベース（OpenJDK 21）             |
| CI/CD   | GitHub Actions / CodePipeline         |
| デプロイ    | ECS Blue/Green または EKS Rolling Update |
| ヘルスチェック | `/actuator/health`                    |

---

## ② 設定パラメータシート（例：Excel想定構造）

| No | カテゴリ   | パラメータ名            | 設定キー                                                  | 値（例）                                                                                             | 適用環境           | 備考             |
| -- | ------ | ----------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------ | -------------- | -------------- |
| 1  | サーバ    | ポート番号             | server.port                                           | 8080                                                                                             | 全環境            | HTTP待受         |
| 2  | DB     | 接続URL             | spring.datasource.url                                 | jdbc:postgresql://db:5432/appdb                                                                  | local          | -              |
| 3  | DB     | ユーザ名              | spring.datasource.username                            | appuser                                                                                          | 全環境            | -              |
| 4  | DB     | パスワード             | spring.datasource.password                            | `${DB_PASSWORD}`                                                                                 | 全環境            | Secrets参照      |
| 5  | JPA    | DDL管理             | spring.jpa.hibernate.ddl-auto                         | none                                                                                             | prod           | updateはlocalのみ |
| 6  | ログ     | 出力レベル             | logging.level.root                                    | INFO                                                                                             | 全環境            | 開発はDEBUG       |
| 7  | セキュリティ | JWT検証URI          | spring.security.oauth2.resourceserver.jwt.jwk-set-uri | [https://auth.example.com/.well-known/jwks.json](https://auth.example.com/.well-known/jwks.json) | 全環境            | -              |
| 8  | メール    | SMTPホスト           | spring.mail.host                                      | smtp.gmail.com                                                                                   | 全環境            | -              |
| 9  | メール    | ユーザ               | spring.mail.username                                  | [noreply@example.com](mailto:noreply@example.com)                                                | 全環境            | -              |
| 10 | 外部API  | APIエンドポイント        | api.external.url                                      | [https://api.partner.com](https://api.partner.com)                                               | stg, prod      | -              |
| 11 | キャッシュ  | 種別                | spring.cache.type                                     | redis                                                                                            | prod           | 開発はcaffeine    |
| 12 | ログ保存先  | logging.file.name | /var/log/app/app.log                                  | prod                                                                                             | CloudWatch転送あり |                |

---

## 補足

* **Spring Boot 3.4**ではJakarta EE 10対応（`javax → jakarta`）済みを前提。
* 可能なら **Spring Boot Actuator** を導入し、全環境でヘルスチェック・メトリクス提供。
* セキュリティと構成情報の分離を目的として、**環境変数管理＋application.yml参照**を基本とします。

---

