# ◆ Salesforce開発概要
Salesforce開発について、**全体像 → 技術要素 → 開発プロセス → 設計・品質・運用 → 金融・公共向けの注意点**の順で、実務レベルまで踏み込んで体系的にご整理します。
（SI／ITコンサル・PM/PL視点を前提にしています）

---

## 1. Salesforce開発とは（全体像）

Salesforceは**CRMを中心としたPaaS／SaaS型業務プラットフォーム**で、
「**設定（ノーコード／ローコード）＋必要最小限のコード**」で業務システムを構築するのが特徴です。

### 主な用途

* 営業管理（SFA）
* 顧客管理（CRM）
* カスタマーサポート（Service Cloud）
* マーケティング（Marketing Cloud）
* 業務アプリ基盤（Platform / Experience Cloud）

---

## 2. Salesforceのアーキテクチャ概要

### 2.1 論理構成

```
[UI]
 ├ Lightning Experience（Web）
 ├ Experience Cloud（ポータル）
 └ Mobile App

[アプリ層]
 ├ 標準オブジェクト
 ├ カスタムオブジェクト
 ├ Flow / Process
 └ Apex / Trigger

[データ層]
 ├ Salesforce DB（マルチテナント）
 └ 外部連携（REST/SOAP）

[連携]
 ├ 外部システム（基幹系）
 └ ETL / iPaaS（MuleSoft等）
```

### 2.2 マルチテナントの前提

* DBやCPUは**共有**
* 利用には**ガバナ制限**あり（重要）
* 高可用性・バックアップはSalesforce側が担保

---

## 3. Salesforce開発の主要技術要素

### 3.1 データ設計（オブジェクト）

| 種類         | 内容                                 |
| ---------- | ---------------------------------- |
| 標準オブジェクト   | Account / Contact / Opportunity など |
| カスタムオブジェクト | 業務固有エンティティ                         |
| 項目（Field）  | テキスト、数値、参照、選択リスト等                  |
| リレーション     | 主従関係 / 参照関係                        |

⚠ **RDB設計と考え方が違う**

* JOINは不可（参照はあるがSQL的JOINではない）
* 正規化しすぎると性能・可読性が悪化

---

### 3.2 ノーコード／ローコード開発

#### Flow（最重要）

* 業務ロジックの中核
* 画面フロー／自動起動フロー／レコードトリガフロー

```
入力 → 条件分岐 → 更新 → 通知
```

**近年は「TriggerよりFlow推奨」**

#### 設定ベース機能

* 入力規則（Validation Rule）
* 自動化（承認プロセス）
* レイアウト・Lightning App Builder

---

### 3.3 コード開発

#### Apex（Javaライク）

* サーバサイド言語
* トリガー、バッチ、REST API

```apex
trigger AccountTrigger on Account (before insert) {
    for (Account acc : Trigger.new) {
        acc.Name = acc.Name + '_AUTO';
    }
}
```

#### Lightning Web Components（LWC）

* フロントエンド（HTML + JS）
* Reactに近い思想

```html
<template>
  <lightning-button label="保存" onclick={handleClick}></lightning-button>
</template>
```

---

## 4. ガバナ制限（超重要）

Salesforce開発で最も重要な制約。

| 制限項目   | 例               |
| ------ | --------------- |
| SOQL回数 | 100回 / トランザクション |
| DML回数  | 150回            |
| CPU時間  | 10秒（同期）         |
| ヒープサイズ | 6MB             |

➡ **バルク処理前提設計が必須**

---

## 5. 開発プロセス（実務標準）

### 5.1 要件定義

* 業務フロー整理
* 標準機能でどこまで対応可能か（Fit & Gap）
* 権限・共有モデル設計

### 5.2 設計

| 設計種別     | 内容               |
| -------- | ---------------- |
| オブジェクト設計 | ER図（Salesforce流） |
| 画面設計     | Lightningページ     |
| 権限設計     | プロファイル／権限セット     |
| 自動化設計    | Flow / Apex      |
| IF設計     | API仕様            |

### 5.3 開発

* Sandbox（Dev / Partial / Full）
* 設定変更＋Apex/LWC
* ソース管理（Git）

### 5.4 テスト

* Apex Test（**コードカバレッジ75%以上必須**）
* UAT（業務シナリオ）

### 5.5 リリース

* Change Set or CI/CD
* 本番反映

---

## 6. 権限・セキュリティ設計

### 6.1 権限制御の階層

1. 組織全体の共有設定
2. ロール階層
3. プロファイル
4. 権限セット
5. レコード共有

**金融・公共ではここが最重要**

---

## 7. 外部システム連携

### 7.1 方式

| 方式                | 用途      |
| ----------------- | ------- |
| REST API          | 同期処理    |
| Platform Event    | 非同期イベント |
| Batch / Queueable | 大量処理    |
| iPaaS             | 複雑連携    |

### 7.2 連携パターン例

* Salesforce ←→ 基幹（勘定系・ERP）
* 夜間バッチ／リアルタイムAPI

---

## 8. 運用・保守

### 8.1 運用作業

* 権限追加
* 項目追加
* Flow修正
* 障害調査（デバッグログ）

### 8.2 バージョンアップ対応

* 年3回の自動アップデート
* 事前検証必須

---

## 9. 金融・公共向けの注意点（重要）

| 観点     | 注意           |
| ------ | ------------ |
| 監査     | 設定変更履歴の管理    |
| セキュリティ | IP制限、項目レベル制御 |
| データ保持  | 外部バックアップ設計   |
| 標準準拠   | コード最小化       |

➡ **「設定変更＝本番影響」の意識が必要**

---

## 10. Salesforce開発者の役割分担

| 役割     | 主業務        |
| ------ | ---------- |
| 管理者    | 設定・運用      |
| 開発者    | Apex / LWC |
| アーキテクト | 全体設計       |
| コンサル   | 業務設計       |

---

## 11. よくある失敗例

* RDB感覚で設計して性能劣化
* Trigger乱立
* 権限設計後回し
* Sandbox管理が破綻

---
